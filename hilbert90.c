/*
* Web based SDR Client for SDRplay
* =============================================================
* Author: DJ0ABR
*
*   (c) DJ0ABR
*   www.dj0abr.de
*
*   This program is free software; you can redistribute it and/or modify
*   it under the terms of the GNU General Public License as published by
*   the Free Software Foundation; either version 2 of the License, or
*   (at your option) any later version.
*
*   This program is distributed in the hope that it will be useful,
*   but WITHOUT ANY WARRANTY; without even the implied warranty of
*   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
*   GNU General Public License for more details.
*
*   You should have received a copy of the GNU General Public License
*   along with this program; if not, write to the Free Software
*   Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.
* 
* hilbert90.c ... band pass to shift by +45 and -45 deg
* this gives 90 degrees, but I and Q have the same delay
* 
* the tables are for +45 degrees
* for -45 deg use the same table, but reverse
* 
*/

#include <stdio.h>
#include "playSDRweb.h"
/*
* designed with Iowa Hills Hilbert Filter Designer
* Parameters:
* Phase Added 
* Smapling Freq: 48000 (does not matter, is just for fun)
* Fc=1,44kHz (0,06)
* BW=2,18 kHz (0,091)
* Taps: 192
* Window: off
* Raised Cosine: 0,94
*/
/*
#define tabsHILB          192  // tabs of hilbert band pass

// bandwidth 2,18 kHz
double FIR_Hilbert_45[tabsHILB] = {
-0.000046052554033047	,
-0.000088171959134163	,
-0.000153227537844668	,
-0.000238773247413858	,
-0.000338077190827683	,
-0.000440649450620377	,
-0.000533500908706459	,
-0.000603011189232170	,
-0.000637172236797390	,
-0.000627888169976330	,
-0.000572967513468773	,
-0.000477451357039866	,
-0.000353984136102116	,
-0.000222048257979826	,
-0.000106037334158910	,
-0.000032316055079212	,
-0.000025583863435250	,
-0.000104999130275663	,
-0.000280607159915973	,
-0.000550631307704415	,
-0.000900122702000763	,
-0.001301322112723654	,
-0.001715880346518077	,
-0.002098834571594249	,
-0.002403978594265757	,
-0.002590030981464330	,
-0.002626831295320830	,
-0.002500711447316666	,
-0.002218216179884154	,
-0.001807490272986952	,
-0.001316901041137231	,
-0.000810798283898519	,
-0.000362691928184879	,
-0.000046502726015712	,
 0.000073137452953233	,
-0.000049660077558457	,
-0.000434106903038305	,
-0.001067515448648636	,
-0.001903731393695384	,
-0.002865768039527853	,
-0.003852688667465394	,
-0.004750232340825820	,
-0.005444147004473958	,
-0.005834752066935851	,
-0.005850965620856472	,
-0.005461948637352449	,
-0.004684666750815461	,
-0.003586048729384942	,
-0.002278998829983253	,
-0.000912239546960819	,
 0.000345258963000758	,
 0.001323760582548212	,
 0.001874038659315153	,
 0.001887930541675415	,
 0.001315543452256571	,
 0.000176689928007886	,
-0.001435346077563316	,
-0.003358813461862311	,
-0.005377375551664106	,
-0.007241893950438770	,
-0.008698096107598113	,
-0.009517233056103471	,
-0.009526245239316035	,
-0.008633743138722373	,
-0.006848326557194231	,
-0.004286414627666046	,
-0.001167789177187580	,
 0.002201630286828368	,
 0.005458797904710401	,
 0.008221907557715397	,
 0.010134417173375473	,
 0.010910112393150661	,
 0.010374138259973466	,
 0.008495024453403633	,
 0.005403396269870029	,
 0.001394256147283308	,
-0.003088667020410444	,
-0.007486130157146216	,
-0.011171840800915062	,
-0.013512073893423199	,
-0.013930900398848208	,
-0.011974574001724119	,
-0.007368357463428972	,
-0.000059510379577657	,
 0.009758714452334392	,
 0.021645503293007021	,
 0.034934636591843149	,
 0.048779304814499873	,
 0.062216196166706018	,
 0.074243417010980403	,
 0.083905254378153216	,
 0.090375911929567565	,
 0.093034252049004895	,
 0.091522282473917152	,
 0.085781576141565882	,
 0.076063868298671788	,
 0.062914530556255913	,
 0.047130228628855381	,
 0.029694562549460749	,
 0.011697609633919654	,
-0.005753175939065096	,
-0.021622463175524641	,
-0.035028731725100834	,
-0.045310779097263138	,
-0.052073244345436372	,
-0.055207461594812254	,
-0.054886402485773471	,
-0.051534986691471579	,
-0.045779375671584105	,
-0.038380782045612800	,
-0.030160639115804269	,
-0.021924563236206573	,
-0.014392365712832492	,
-0.008140471782960559	,
-0.003561597907481744	,
-0.000844601592413370	,
 0.000024733389558840	,
-0.000756652653383335	,
-0.002845743936714838	,
-0.005801664286274234	,
-0.009139822101738889	,
-0.012386077007003190	,
-0.015125379888304830	,
-0.017040260400061298	,
-0.017935894258016227	,
-0.017750108745226437	,
-0.016548389707486299	,
-0.014505548443619992	,
-0.011877025295910068	,
-0.008963720389095877	,
-0.006074674181143010	,
-0.003491852000798359	,
-0.001440754963830889	,
-0.000069671575956439	,
 0.000560775857869809	,
 0.000477402803931232	,
-0.000215610487054815	,
-0.001354751977870522	,
-0.002740523905975884	,
-0.004163045385717997	,
-0.005426821888949265	,
-0.006371914167642895	,
-0.006889356096931626	,
-0.006929491627896326	,
-0.006502816835214801	,
-0.005673811170496444	,
-0.004549019141150335	,
-0.003261217343031619	,
-0.001951819052403478	,
-0.000753710158828725	,
 0.000223509289650068	,
 0.000904339679542745	,
 0.001253299579764327	,
 0.001275647748503745	,
 0.001013250354762149	,
 0.000536484464168155	,
-0.000066530202109462	,
-0.000701864542745731	,
-0.001281355200723007	,
-0.001732467029249891	,
-0.002005407605319762	,
-0.002076877757822500	,
-0.001950302365469226	,
-0.001652827331095401	,
-0.001229738771235048	,
-0.000737219049416645	,
-0.000234478214689568	,
 0.000223715866457857	,
 0.000593226655764435	,
 0.000844814568169643	,
 0.000966135309705453	,
 0.000961443264857608	,
 0.000849263932202364	,
 0.000658531543543407	,
 0.000423835963138429	,
 0.000180474913213897	,
-0.000040034965217088	,
-0.000213458068016693	,
-0.000325001749272591	,
-0.000370001228619998	,
-0.000353197329159700	,
-0.000286856892417141	,
-0.000188115417041214	,
-0.000075987874351330	,
 0.000031506655408273	,
 0.000119722035515734	,
 0.000178987662301608	,
 0.000205296969296481	,
 0.000200085607151008	,
 0.000169232723927939	,
 0.000121517676789744	,
 0.000066821251490960	
};
*/

/*
* designed with Iowa Hills Hilbert Filter Designer
* Parameters:
* Phase Added 
* Smapling Freq: 48000 (does not matter, is just for fun)
* Fc=1,88kHz (0,0784)
* BW=3.6 kHz (0,15)
* Taps: 192
* Window: off
* Raised Cosine: 0,94
*/

#define tabsHILB          192  // tabs of hilbert band pass

// bandwidth 3,6 kHz
double FIR_Hilbert_45[tabsHILB] = {
 0.000758543888401327	,
 0.000819601686999888	,
 0.000865697755433279	,
 0.000876477445110173	,
 0.000839074584783280	,
 0.000754429259346580	,
 0.000640094487589759	,
 0.000528040905801393	,
 0.000457354600709360	,
 0.000463319893462307	,
 0.000565721869601927	,
 0.000759854338060235	,
 0.001013398158165816	,
 0.001271021032042775	,
 0.001466512765938489	,
 0.001540022428152739	,
 0.001456137823082643	,
 0.001217724208848915	,
 0.000870975364603003	,
 0.000499033383284134	,
 0.000204422640475258	,
 0.000083715541426133	,
 0.000200443303492789	,
 0.000563492708953465	,
 0.001117594158732823	,
 0.001749976374482219	,
 0.002313327614499601	,
 0.002660788801491808	,
 0.002684964086720852	,
 0.002350956895995879	,
 0.001713943807118220	,
 0.000914904755378183	,
 0.000153266689229653	,
-0.000358782208838111	,
-0.000450204533483057	,
-0.000039942705991130	,
 0.000832651947639489	,
 0.002005607286757948	,
 0.003223734465977603	,
 0.004195122709571547	,
 0.004662706546439108	,
 0.004473824682832922	,
 0.003629599281654389	,
 0.002299488665078533	,
 0.000794003600900433	,
-0.000501285384792620	,
-0.001217083816219265	,
-0.001095976954136229	,
-0.000068247182689671	,
 0.001713227046864845	,
 0.003891545155454785	,
 0.005977865235859000	,
 0.007463423010146054	,
 0.007946605432909039	,
 0.007244230894680351	,
 0.005457526767223736	,
 0.002972199435366057	,
 0.000386835850135639	,
-0.001618591612825977	,
-0.002446306367395932	,
-0.001738176770784013	,
 0.000512906955215236	,
 0.003929577113784296	,
 0.007809622675224986	,
 0.011272058107036973	,
 0.013460987931495595	,
 0.013761887454234539	,
 0.011977951475623805	,
 0.008419447923794425	,
 0.003876234491941912	,
-0.000530486562835609	,
-0.003592072478194451	,
-0.004301509784178535	,
-0.002121776847290062	,
 0.002833295293258965	,
 0.009757585675356621	,
 0.017274225143825813	,
 0.023707443737505513	,
 0.027455816234308882	,
 0.027390148149583841	,
 0.023186787152820798	,
 0.015514009814880304	,
 0.006015091466043234	,
-0.002927850168764004	,
-0.008618242336764999	,
-0.008583347164835168	,
-0.001122097608962406	,
 0.014251308583303540	,
 0.036567556415026500	,
 0.063429499169171344	,
 0.091318770180977726	,
 0.116137813440894841	,
 0.133894061026482630	,
 0.141400898061990132	,
 0.136862420066332813	,
 0.120227989989994247	,
 0.093244879321716268	,
 0.059194544219223835	,
 0.022358835564825604	,
-0.012685651911097013	,
-0.041814361703421031	,
-0.062005348703382791	,
-0.071776765264283185	,
-0.071337484524353942	,
-0.062433786083713451	,
-0.047933627071912725	,
-0.031238652049625743	,
-0.015643220742642988	,
-0.003764093050343213	,
 0.002855980474401381	,
 0.003907522532385958	,
 0.000223817378778733	,
-0.006521654371629272	,
-0.014252359591724358	,
-0.020961458360076860	,
-0.025121372571103390	,
-0.025951994700703768	,
-0.023504797874049431	,
-0.018561998577184657	,
-0.012388961997213266	,
-0.006406089020811964	,
-0.001858206784410083	,
 0.000446425809079279	,
 0.000276477830613220	,
-0.002023143488866000	,
-0.005660713560839218	,
-0.009616025495869105	,
-0.012891268796034075	,
-0.014735358587934625	,
-0.014793331588403409	,
-0.013153182459687208	,
-0.010287909956362513	,
-0.006914496795544962	,
-0.003808734639630601	,
-0.001621814651820871	,
-0.000740586833952981	,
-0.001220082683716420	,
-0.002798038181926585	,
-0.004981498321144213	,
-0.007179722950444016	,
-0.008848930052087763	,
-0.009614381170650206	,
-0.009343292043816056	,
-0.008155579713606862	,
-0.006374962184233935	,
-0.004436636919279115	,
-0.002776609489478369	,
-0.001730023727936807	,
-0.001461530891158510	,
-0.001941353555930880	,
-0.002968855776643311	,
-0.004234112358366368	,
-0.005399810316077696	,
-0.006182494656097517	,
-0.006414087801888266	,
-0.006070888740622881	,
-0.005266046318809592	,
-0.004210501194234964	,
-0.003154437679757033	,
-0.002324859090751088	,
-0.001874435953395443	,
-0.001852730524443626	,
-0.002204553455243848	,
-0.002793286836859562	,
-0.003441231912344452	,
-0.003975703714453121	,
-0.004269288173489219	,
-0.004265200143150282	,
-0.003983160791864006	,
-0.003506376562165067	,
-0.002954723226847537	,
-0.002452070058578815	,
-0.002096286433388086	,
-0.001938921711936508	,
-0.001978433862702049	,
-0.002167090847199031	,
-0.002428279308103193	,
-0.002678738574993306	,
-0.002849631226980618	,
-0.002901351434616322	,
-0.002829141881149462	,
-0.002659262643741596	,
-0.002437893176211943	,
-0.002216548426466181	,
-0.002038227199106462	,
-0.001927796305656434	,
-0.001888560042957525	,
-0.001905073408909038	,
-0.001950570468830153	,
-0.001996328711320549	,
-0.002020093660794591	,
-0.002011309487443369	
};

double BandPass45deg(double sample)
{
static double circular_buffer[tabsHILB];
double *pcoeff = FIR_Hilbert_45;
static int wr_idx = 0;
double y;

    // write value to buffer
    circular_buffer[wr_idx] = sample;
    
    // increment write index
    wr_idx++;
    wr_idx %= tabsHILB;
    
    // calculate new value
    y = 0;
    int idx = wr_idx;
    for(int i = 0; i < tabsHILB; i++)
    {
        y += (*pcoeff++ * circular_buffer[idx++]);
        if(idx >= tabsHILB) idx=0;
    }

    return y;
}

// -45 deg uses the same coeff table, but in reverse order
double BandPassm45deg(double sample)
{
static double circular_buffer[tabsHILB];
double *pcoeff = FIR_Hilbert_45 + tabsHILB - 1; // goto the last value in the table
static int wr_idx = 0;
double y;

    // write value to buffer
    circular_buffer[wr_idx] = sample;
    
    // increment write index
    wr_idx++;
    wr_idx %= tabsHILB;
    
    // calculate new value
    y = 0;
    int idx = wr_idx;
    for(int i = 0; i < tabsHILB; i++)
    {
        y += (*pcoeff-- * circular_buffer[idx++]);
        if(idx >= tabsHILB) idx=0;
    }

    return y;
}
